---
ìƒì„±ì¼ì: Invalid date
ì‘ì„±ì: ê¹€ì˜íƒ
ì£¼ì°¨: 2ì£¼ì°¨
---
> ë¶€ì¡±í–ˆë˜ ì  íŒ”ë¡œìš° ì—…

## key - path ë€ ë¬´ì—‡ì¸ê°€?

`ê°ì²´ì˜ í”„ë¡œí¼í‹°ë¥¼ ë™ì ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥`

  

í˜•íƒœ : `\<Type>.property` â†’ `<Type>` ë¶€ë¶„ ì¦‰, ë£¨íŠ¸ íƒ€ì…ì€ ìƒëµ ê°€ëŠ¥

- Optional ì¸ ê²½ìš° `\.?.property` ë¡œ ì ‘ê·¼

  

> [!important]
> 
> ### ì•„ë‹ˆ ê·¼ë° ì›ë˜ `<ê°ì²´ì´ë¦„>.<í”„ë¡œí¼í‹° ì´ë¦„>` ìœ¼ë¡œ ì°¸ì¡°í•  ìˆ˜ ìˆë˜ê±° ì•„ë‹˜?
> 
> í•˜ì§€ë§Œ í‚¤íŒ¨ìŠ¤ë¥¼ ì“°ë©´â€¦
> 
>   
> 
> > ë¬¸ìì—´ì´ ì•„ë‹Œ í”„ë¡œí¼í‹° ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•˜ê¸° ë•Œë¬¸ì— ì˜¤íƒ€ë°©ì§€ì— íƒì›”
> 
> ```Swift
> // KeyPathë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ ê²½ìš° -> ë¬¸ìì—´ì„ ì§ì ‘ ì…ë ¥í•˜ë¯€ë¡œ ì˜¤íƒ€ë‚  ê°€ëŠ¥ì„±ì´ ì¡´ì¬
> person.value(forKey: "name")
> 
> // KeyPathë¥¼ ì‚¬ìš©í•œ ê²½ìš°
> person[keyPath: \.name]
> ```
> 
>   
> 
> > ë™ì ì¸ ì‚¬ìš© ê°€ëŠ¥
> 
> - íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ë¡œ ê³ ì •ë˜ë²„ë¦¬ëŠ” ê¸°ì¡´ ë°©ë²•ê³¼ ë‹¬ë¦¬
> - ê°™ì€ íƒ€ì…ì˜ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì— ì‚¬ìš© ê°€ëŠ¥
> 
> ```Swift
> struct Person {
>     var name: String
>     var age: Int
> }
> 
> let person = Person(name: "Alice", age: 25)
> 
> // ğŸ”¥ Key Pathë¥¼ ì‚¬ìš©í•˜ë©´ íŠ¹ì • í”„ë¡œí¼í‹°ë¥¼ ìœ ë™ì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥!
> let keyPath: KeyPath<Person, String> = \Person.name
> print(person[keyPath: keyPath])  // âœ… "Alice"
> ```
> 
>   
> 
> > í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œ $0 ëŒ€ì‹  ì‚¬ìš©ê°€ëŠ¥ (ê°€ë…ì„±ì´ ì¢‹ì•„ì§€ëŠ”ê²Œ ë§ëŠ”ì§€ëŠ” ì˜ë¬¸)
> 
> ```Swift
> let people = [
>     Person(name: "Alice", age: 25),
>     Person(name: "Bob", age: 30)
> ]
> 
> // ğŸ”¥ Key Pathë¥¼ í™œìš©í•œ `map`
> let names = people.map(\.name)  
> print(names)  // âœ… ["Alice", "Bob"]
> ```
> 
>   
> 
> > ë¦¬ìŠ¤íŠ¸ í•„í„°ë§ì—ì„œ ì‚¬ìš©
> 
> - `arr.sorted { $0.age < $1.age }` ì´ë ‡ê²Œ ì“¸í•„ìš” ì—†ì–´ì§
>     
>     ```Swift
>     let sortedPeople = people.sorted(by: \.age)
>     print(sortedPeople.map(\.name))  // âœ… ["Alice", "Bob"]
>     ```
>     

## subcription ì€ ë¬´ì—‡ì¸ê°€?

`publisherì™€ subscriber ì‚¬ì´ì˜ ì—°ê²°ì„ ë‹´ë‹¹í•˜ëŠ” íŒŒì´í”„ ì—­í• `

- subscriptionë„ Cancellable í”„ë¡œí† ì½œì„ ì±„íƒí•œ í”„ë¡œí† ì½œ

  

> subscription ì˜ˆì œ

```Swift
import Combine

let publisher = ["ğŸ“¢ ë‰´ìŠ¤ 1", "ğŸ“¢ ë‰´ìŠ¤ 2", "ğŸ“¢ ë‰´ìŠ¤ 3"].publisher
let subscription = publisher.sink { news in
    print("ğŸ“° ë°›ì€ ë‰´ìŠ¤: \(news)")
}

// 2ì´ˆ í›„ êµ¬ë… ì·¨ì†Œ
DispatchQueue.main.asyncAfter(deadline: .now() + 2) {
    subscription.cancel()
    print("ğŸ›‘ ë‰´ìŠ¤ êµ¬ë… ì·¨ì†Œë¨!")
}
```

- `.sink` ê°€ subscriber ì—­í• ì„ í•˜ëŠ” ê°ì²´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ìƒì„±
- `publisher.sink` ì˜ ê²°ê³¼ë¬¼ì´ ë°”ë¡œ subscription(êµ¬ë… ê°ì²´)
- subscriptionì˜ íƒ€ì…ì€ Anycancellable
    
    â†’ êµ¬ë…ì„ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì»´ë°”ì¸ì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´
    
    â†’ Cancellable í”„ë¡œí† ì½œì„ ë”°ë¥´ê¸° ë•Œë¬¸ì— .cancel() í˜¸ì¶œí•˜ì—¬ êµ¬ë…ì„ ì¤‘ì§€í•  ìˆ˜ ìˆìŒ
    
- subscriptionì„ ë³€ìˆ˜ì— ì €ì¥í•˜ì§€ ì•Šìœ¼ë©´ ë°”ë¡œ í•´ì œ ë  ìˆ˜ ìˆìŒ
    - ê·¸ë˜ì„œ ì˜ˆì œì²˜ëŸ¼ ë³€ìˆ˜ ëŒ€ì…ëŒ€ì‹  `.store(in: &cancellables)` ë¡œ ì €ì¥ í•  ìˆ˜ ë„ ìˆìŒ

  

> `.store(in: &cancellables)` ì˜ˆì œ

```Swift
import Combine
import Foundation

var cancellables = Set<AnyCancellable>()  // âœ… Subscription ì €ì¥ ê³µê°„

let publisher = Timer.publish(every: 1, on: .main, in: .common).autoconnect()

publisher
    .sink { time in
        print("ğŸ•’ í˜„ì¬ ì‹œê°„: \(time)")
    }
    .store(in: &cancellables)  // âœ… Subscriptionì„ ì €ì¥í•˜ì—¬ ìœ ì§€!
```

- cancellables ì— subscriptionë“¤ì„ ì €ì¥í•´ì„œ ê´€ë¦¬
- `cancellables.removeAll()` ì„ í˜¸ì¶œí•˜ì—¬ ëª¨ë“  subscription ì·¨ì†Œ

> [!important]
> 
> ### `&(ì•°í¼ìƒŒë“œ)` ëŠ” ì™œ ì“¸ê¹Œ?
> 
> Swiftì˜ inout íŒŒë¼ë¯¸í„° ì‚¬ìš©í• ë•Œ ì“°ëŠ” ë¬¸ë²• â†’ ë³€ìˆ˜ ìì²´ë¥¼ í•¨ìˆ˜ì— ì „ë‹¬
> 
>   
> 
> - í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ” ë³€ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ â€˜ë³µì‚¬ë³¸â€™ì´ ì „ë‹¬ë¨
> - inout íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë©´ ë³€ìˆ˜ë¥¼ ì§ì ‘ ì „ë‹¬í•  ìˆ˜ê°€ ìˆëŠ”ë°
> - ì´ë•Œ &ì„ ë³€ìˆ˜ì•ì— ë¶™ì—¬ â€˜ì´ ë³€ìˆ˜ëŠ” ë³€í•  ìˆ˜ ìˆë‹¤â€™ ëŠ”ê±¸ ì•Œë ¤ì¤Œ

## notificationCenter ì™œ ì‚­ì œí•´ë„ completionì´ ë˜ì§€ ì•ŠëŠ”ê°€

[https://jeonyeohun.tistory.com/223](https://jeonyeohun.tistory.com/223)

> notificationCenter ì˜ˆì œ

```Swift
import Combine
import Foundation

let myNotification = Notification.Name("MyNotification")

// âœ… NotificationCenter í¼ë¸”ë¦¬ì…” ìƒì„±
let publisher = NotificationCenter.default.publisher(for: myNotification)

// âœ… êµ¬ë… (Subscription ìƒì„±)
let subscription = publisher.sink { completion in
    print(completion)
} receiveValue: { value in
    print(value.object as? String ?? "No Value")
}


// ğŸš€ ì•Œë¦¼(Notification) ë³´ë‚´ê¸°
NotificationCenter.default.post(name: myNotification, object: "message")

// ğŸ”¥ êµ¬ë… í•´ì œ
subscription.cancel()
```

- ë§ˆì§€ë§‰ì— .cancel()ì„ í–ˆëŠ”ë°ë„ completionì„ ë°›ì€ ì¶œë ¥ë¬¼ì´ ì•ˆë‚˜ì˜´
- completionì€ ìŠ¤íŠ¸ë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ëë‚¬ì„ ë•Œ í˜¸ì¶œì´ ë˜ëŠ”ë°
- notificationCenterëŠ” **ì´ë²¤íŠ¸ ê¸°ë°˜ì˜ ë¬´í•œ ìŠ¤íŠ¸ë¦¼ í¼ë¸”ë¦¬ì…”**ì´ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ëë‚¬ë‹¤! ë¼ëŠ” ê°œë… ìì²´ê°€ ì—†ë‹¤!

  

> ì˜¤ê¸°ë¡œ notificationCenterì—ì„œ completionì„ í˜¸ì¶œí•˜ê³  ì‹¶ë‹¤ë©´?

1. subscriptionì˜ ìˆ˜ìš”ì¡°ì ˆ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬ í•œë²ˆë§Œ valueë¥¼ ë°›ê³  ì¢…ë£Œ
    
    ```Swift
    let subscription = NotificationCenter.default.publisher(for: myNotification)
        .take(1)  // âœ… ì²« ë²ˆì§¸ ì´ë²¤íŠ¸ë§Œ ìˆ˜ì‹ í•˜ê³  ì¢…ë£Œ!
        .sink(receiveCompletion: { _ in print("âœ… ì™„ë£Œ (completion í˜¸ì¶œë¨)") },
              receiveValue: { print("ğŸ“¢ ì•Œë¦¼ ë°œìƒ! ë°ì´í„°: \( $0 )") })
    
    NotificationCenter.default.post(name: myNotification, object: nil)
    ```
    
2. timeoutì„ ì´ìš©í•˜ì—¬ ìë™ ì¢…ë£Œ
    
    ```Swift
    let subscription = NotificationCenter.default.publisher(for: myNotification)
        .timeout(.seconds(5), scheduler: RunLoop.main, customError: nil)  // â„ 5ì´ˆ í›„ ìë™ ì¢…ë£Œ
        .sink(receiveCompletion: { _ in print("âœ… ì™„ë£Œ (completion í˜¸ì¶œë¨)") },
              receiveValue: { print("ğŸ“¢ ì•Œë¦¼ ë°œìƒ! ë°ì´í„°: \( $0 )") })
    ```
    

  

  

> ì»´ë°”ì¸ ì´ë¡  ë¸”ë¡œê·¸

## Chapter 3. Transforming Operators

`ì˜¤í¼ë ˆì´í„°ë“¤ì€ ì‚¬ì‹¤ í¼ë¸”ë¦¬ì…”ë¥¼ return í•œë‹¤`

`ê³ ì°¨í•¨ìˆ˜ì™€ ìœ ì‚¬`

  

### ë°ì´í„° ë³€í™˜ ì˜¤í¼ë ˆì´í„°ë“¤

1. `scan(ì´ˆê¹ƒê°’) { $0 + $1 }` â†’ ëˆ„ì ê²°ê³¼ë¥¼ ë‹¨ê³„ë³„ë¡œ ë°©ì¶œí•˜ëŠ” ì—°ì‚°ì
    
    ```Swift
    import Combine
    
    let numbers = [1, 2, 3, 4].publisher
    
    numbers
        .scan(0) { $0 + $1 }  // âœ… ì´ì „ ëˆ„ì ê°’ + ìƒˆë¡œìš´ ê°’
        .sink { print($0) }
    
    // âœ… ì¶œë ¥:
    // 1  (0 + 1)
    // 3  (1 + 2)
    // 6  (3 + 3)
    // 10 (6 + 4)
    ```
    
2. `map` â†’ $0ìœ¼ë¡œ ê°’ì„ ë°›ì•„ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥
    
    > í‚¤íŒ¨ìŠ¤ ì‚¬ìš©ì‹œ
    
    ```Swift
    let publisher = PassthroughSubject<Coordinate, Never>()
    
    publisher
      .map(\.x, \.y)
      .sink(receiveValue: { x, y in
          print("The coordinate at (\(x), \(y)) is in quadrant", quadrantOf(x: x, y: y))
      })
      .store(in: &subscriptions)
    
    publisher.send(Coordinate(x: 10, y: -8))
    publisher.send(Coordinate(x: 0, y: 5))
    ```
    
3. `flatMap` â†’ ì—¬ëŸ¬ í¼ë¸”ë¦¬ì…”ë¥¼ í•˜ë‚˜ë¡œ í¼ì¹¨
    
    ```Swift
    import Combine
    
    struct User {
        let name: String
        let favoriteNumbers: [Int]
    }
    
    let users = [
        User(name: "Alice", favoriteNumbers: [1, 2]),
        User(name: "Bob", favoriteNumbers: [3, 4])
    ].publisher
    
    users
        .flatMap { user in
            user.favoriteNumbers.publisher  // âœ… ì—¬ëŸ¬ í¼ë¸”ë¦¬ì…”ë¥¼ í•˜ë‚˜ë¡œ í¼ì¹¨!
        }
        .sink { print($0) }  
    
    // âœ… ì¶œë ¥:
    // 1
    // 2
    // 3
    // 4
    ```
    
    - favoriteNumbersì˜ ê°’ì„ ê°ê° ë°°ì—´ í¼ë¸”ë¦¬ì…”ë¡œ ë§Œë“¤ì–´ë²„ë¦¼
4. `compactMap()` â†’ nilì„ ë¬´ì‹œí•´ì£¼ëŠ” map
5. `collect(n)`
    
    â†’ ê°œë³„ valueë“¤ì„ ë°°ì—´ë¡œ ë³€ê²½, ë²„í¼ì— ì €ì¥í•´ë’€ë‹¤ê°€ completionë•Œ ë°°ì—´ë¡œ ì¶œë ¥, nê°œì”© ë¬¶ì–´ì¤Œ
    
    â†’ nì´ ì—†ì„ê²½ìš° ë¬´í•œì • ë°°ì—´ì„ ì±„ìš¸ ìˆ˜ ìˆìŒ;; ë©”ëª¨ë¦¬ ê´€ë¦¬ì— ì£¼ì˜
    

  

## Chapter 4. Filtering Operators

### ë°ì´í„° í•„í„°ë§

1. `filter` â†’ íŠ¹ì • ì¡°ê±´ì— í•´ë‹¹í•˜ëŠ” ê°’ë§Œ ì „ë‹¬
2. `removeDuplicates` â†’ ì—°ì†ëœ ì¤‘ë³µ ê°’ ì œê±°
    
    ```Swift
    let numbers = [1, 1, 2, 2, 3, 3, 1].publisher
    
    numbers
        .removeDuplicates()
        .sink { print($0) }
    
    // âœ… ì¶œë ¥:
    // 1
    // 2
    // 3
    // 1
    ```
    
3. `replaceNil(with:)` â†’ nil ì„ íŠ¹ì • ê°’ìœ¼ë¡œ ë°”ê¿”ì¤Œ
4. `replaceEmpty(with:)` â†’ valueê°€ emitë˜ì§€ ì•Šê³  ì™„ë£Œëì„ ë•Œ, valueë¥¼ í•˜ë‚˜ ë„£ì–´ ì¤Œ

  

### ì‹œê°„ ì¡°ì‘

1. debounce â†’ ì§§ì€ ì‹œê°„ ë™ì•ˆ ì¤‘ë³µ ìš”ì²­ì„ ë¬´ì‹œ
    
    ```Swift
    let subject = PassthroughSubject<String, Never>()
    
    subject
        .debounce(for: .seconds(1), scheduler: RunLoop.main)
        .sink { print("ğŸ“¢ ë°›ì€ ê°’: \($0)") }
    
    // ğŸ”¥ ì‚¬ìš©ì ì…ë ¥(íƒ€ì´í•‘) ì‹œë®¬ë ˆì´ì…˜
    subject.send("H")
    subject.send("He")
    subject.send("Hel")
    subject.send("Hell")
    subject.send("Hello")
    
    // âœ… "Hello" í•œ ë²ˆë§Œ ì¶œë ¥ (1ì´ˆ ë‚´ ì¤‘ë³µ ì…ë ¥ ë°©ì§€)
    ```
    
    > [!important]
    > 
    > ### ê²€ìƒ‰ì°½ êµ¬í˜„ì‹œì— ìš”ê¸´í•˜ë‹¤
    > 
    > - íŠ¹íˆ í•œê¸€ë¡œ ê²€ìƒ‰í• ë•Œ ìŒìš´ í•˜ë‚˜í•˜ë‚˜ë§ˆë‹¤ apië¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ í•˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆëŠ”ë°
    > - debounceë¥¼ ê±¸ì–´ì„œ ë§ˆì§€ë§‰ ì…ë ¥ê°’ë§Œ ì „ë‹¬í•˜ë©´ ë˜ëŠ”ê±°ì˜€ë‹¤!
    

  

## Chapter 5. Combining Operators

Â `ì—¬ëŸ¬ê°œì˜ í¼ë¸”ë¦¬ì…”(Publisher)ì—ì„œ ë‚˜ì˜¤ëŠ” ë°ì´í„°ë¥¼ ê²°í•©í•˜ëŠ” ê¸°ëŠ¥`

  

### í¼ë¸”ë¦¬ì…” ê²°í•© ì—°ì‚°ì

1. `merge` â†’ ì—¬ëŸ¬ í¼ë¸”ë¦¬ì…”ì˜ ì´ë²¤íŠ¸ë¥¼ ë‹¨ìˆœ ë°œìƒ ìˆœì„œëŒ€ë¡œ í•©ì¹¨
    
    ```Swift
    import Combine
    
    let publisher1 = PassthroughSubject<String, Never>()
    let publisher2 = PassthroughSubject<String, Never>()
    
    let mergedPublisher = publisher1.merge(with: publisher2)
    
    mergedPublisher.sink { print("ğŸ“¢ ê°’ ìˆ˜ì‹ : \($0)") }
    
    publisher1.send("ğŸ”µ ì²« ë²ˆì§¸ ê°’ 1")
    publisher2.send("ğŸŸ  ë‘ ë²ˆì§¸ ê°’ 1")
    publisher1.send("ğŸ”µ ì²« ë²ˆì§¸ ê°’ 2")
    publisher2.send("ğŸŸ  ë‘ ë²ˆì§¸ ê°’ 2")
    
    // âœ… ì¶œë ¥ ê²°ê³¼ (ìˆœì„œëŒ€ë¡œ ì „ë‹¬ë¨)
    // ğŸ“¢ ê°’ ìˆ˜ì‹ : ğŸ”µ ì²« ë²ˆì§¸ ê°’ 1
    // ğŸ“¢ ê°’ ìˆ˜ì‹ : ğŸŸ  ë‘ ë²ˆì§¸ ê°’ 1
    // ğŸ“¢ ê°’ ìˆ˜ì‹ : ğŸ”µ ì²« ë²ˆì§¸ ê°’ 2
    // ğŸ“¢ ê°’ ìˆ˜ì‹ : ğŸŸ  ë‘ ë²ˆì§¸ ê°’ 2
    ```
    
2. `combineLatest` â†’ ë‘ í¼ë¸”ë¦¬ì…”ì˜ â€˜ìµœì‹  ê°’â€™ì„ ì¡°í•©, ìµœì‹ ê°’ì´ ê°±ì‹ ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì¡°í•©ì´ ì‹¤í–‰ë¨
3. `zip` â†’ ë‘ í¼ë¸”ë¦¬ì…”ì˜ ê°™ì€ ì¸ë±ìŠ¤ ê°’ì„ ê²°í•©
    
    ```Swift
    let numbers = [1, 2, 3].publisher
    let letters = ["A", "B", "C"].publisher
    
    numbers.zip(letters)
        .sink { print("ğŸ”— ë¬¶ì¸ ê°’: \($0), \($1)") }
    
    // âœ… ê²°ê³¼:
    // ğŸ”— ë¬¶ì¸ ê°’: 1, A
    // ğŸ”— ë¬¶ì¸ ê°’: 2, B
    // ğŸ”— ë¬¶ì¸ ê°’: 3, C
    ```
    
4. append â†’ í•œ í¼ë¸”ë¦¬ì…”ê°€ ëë‚œ ë’¤ ë‹¤ë¥¸ í¼ë¸”ë¦¬ì…”ë¥¼ ì‹¤í–‰
5. switchToLatest â†’ ìµœì‹  í¼ë¸”ë¦¬ì…”ë§Œ ìœ ì§€
    
    ```Swift
    let subject = PassthroughSubject<PassthroughSubject<String, Never>, Never>()
    
    subject
        .switchToLatest()
        .sink { print("ğŸ“¢ ìµœì‹  ê°’: \($0)") }
    
    // ğŸ”¥ ì²« ë²ˆì§¸ ìš”ì²­ ì‹œì‘
    let firstRequest = PassthroughSubject<String, Never>()
    subject.send(firstRequest)
    
    firstRequest.send("ğŸ”µ ì²« ë²ˆì§¸ ìš”ì²­ ì¤‘...")  
    firstRequest.send("ğŸ”µ ì²« ë²ˆì§¸ ì‘ë‹µ ì™„ë£Œ")  
    
    // ğŸ”¥ ë‘ ë²ˆì§¸ ìš”ì²­ì´ ì§„í–‰ë˜ë©´ ì²« ë²ˆì§¸ ìš”ì²­ì€ ìë™ ì·¨ì†Œ
    let secondRequest = PassthroughSubject<String, Never>()
    subject.send(secondRequest)
    
    secondRequest.send("ğŸŸ  ìƒˆë¡œìš´ ìš”ì²­ ì‹œì‘!")  
    secondRequest.send("ğŸŸ  ìƒˆë¡œìš´ ìš”ì²­ ì™„ë£Œ!")  
    
    // âœ… ì¶œë ¥:
    // ğŸ“¢ ìµœì‹  ê°’: ğŸ”µ ì²« ë²ˆì§¸ ìš”ì²­ ì¤‘...
    // ğŸ“¢ ìµœì‹  ê°’: ğŸ”µ ì²« ë²ˆì§¸ ì‘ë‹µ ì™„ë£Œ
    // ğŸ“¢ ìµœì‹  ê°’: ğŸŸ  ìƒˆë¡œìš´ ìš”ì²­ ì‹œì‘!
    // ğŸ“¢ ìµœì‹  ê°’: ğŸŸ  ìƒˆë¡œìš´ ìš”ì²­ ì™„ë£Œ!
    ```
    
    - ê¸°ì¡´ì˜ ìš”ì²­ì´ ì‹¤í–‰ ì¤‘ì´ì–´ë„, ìƒˆë¡œìš´ ìš”ì²­ì´ ì˜¤ë©´ ê¸°ì¡´ìš”ì²­ ì·¨ì†Œí•˜ê³  ìƒˆ ìš”ì²­ ì‹¤í–‰
    - apiê²€ìƒ‰ ê¸°ëŠ¥ì— ìš”ê¸´í• ë“¯

  

> ì»´ë°”ì¸ ì‹¤ìŠµ ì˜ˆì œ

- ì• í”Œ ê¸°ë³¸ ì‹œê³„ ì•± - ìŠ¤í†±ì›Œì¹˜ ê¸°ëŠ¥
    
    https://github.com/kut7728/Combine_TimeWatchClone
    

  

### StopwatchView.swift

```Swift
import SwiftUI

struct StopwatchView: View {
    @StateObject private var viewModel = StopwatchViewModel()  //ViewModel
    
    // 00:00.00
    private var formattedTime: String {
        let minutes = Int(viewModel.elapsedTime) / 60
        let seconds = Int(viewModel.elapsedTime) % 60
        let milliseconds = Int((viewModel.elapsedTime.truncatingRemainder(dividingBy: 1)) * 100)
        /// elapsedTimeì˜ í˜•íƒœëŠ” 123.433ì˜ í˜•íƒœ
        /// truncatingRemainder(dividingBy:1) ì€ ì†Œìˆ˜ì  ì´í•˜ë§Œ ë°œì·Œí•˜ëŠ” ì—­í•  -> 0.433
        /// 100ì„ ê³±í•´ ë°€ë¦¬ì´ˆë¡œ ë³€í™˜í•˜ê³  -> 43.3
        /// Intë¡œ ì •ìˆ˜ë¡œ ë³€í™˜ -> 43
        return String(format: "%02d:%02d.%02d", minutes, seconds, milliseconds)
        /// ë¬¸ìì—´ í¬ë§· - %d (ì •ìˆ˜ í‘œí˜„) %2d (ì •ìˆ˜ë¥¼ ë‘ìë¦¬ë¡œ í‘œí˜„í•˜ë˜ ë¹ˆìë¦¬ëŠ” ê³µë°±) %02d (ì •ìˆ˜ë¥¼ ë‘ìë¦¬ë¡œ í‘œí˜„í•˜ë˜ ë¹ˆìë¦¬ëŠ” 0)
    }
    
    var body: some View {
        VStack {
            Text(formattedTime)
                .font(.system(size: 80))
                .fontWeight(.thin)
                .foregroundStyle(.white)
                .padding(.bottom, 80)
            
            
            
            // ë²„íŠ¼
            HStack {
                Button {
                    viewModel.isRunning ? viewModel.lap() : viewModel.reset()
                } label: {
                    Text(viewModel.isRunning ? "ë©" : "ì¬ì„¤ì •")
                        .frame(width: 100, height: 100)
                        .background(Color.gray.opacity(0.3))
                        .foregroundColor(.white)
                        .clipShape(Circle())
                }

                
                Spacer()
                
                Button {
                    viewModel.isRunning ? viewModel.stop() : viewModel.start()
                } label: {
                    Text(viewModel.isRunning ? "ì •ì§€" : "ì‹œì‘")
                        .frame(width: 100, height: 100)
                        .background(viewModel.isRunning ? Color.red : Color.green)
                        .foregroundColor(viewModel.isRunning ? .white : .black)
                        .clipShape(Circle())
                }
            }
            .padding(.horizontal, 10)
            
            // ë©
            List(viewModel.laps.indices.reversed(), id: \.self) { index in
                let lapTime = index > 0 ? viewModel.laps[index] - viewModel.laps[index - 1] : viewModel.laps[index]

                let lapMinutes = Int(lapTime) / 60
                let lapSeconds = Int(lapTime) % 60
                let lapMilliseconds = Int((lapTime.truncatingRemainder(dividingBy: 1)) * 100)
                
                HStack {
                    Text("ë© \(index + 1)")  // ë© ë²ˆí˜¸ í‘œì‹œ
                    
                    Spacer()
                    
                    Text(String(format: "%02d:%02d.%02d", lapMinutes, lapSeconds, lapMilliseconds))
                        .foregroundColor(.white)
                }
                .font(.title3)
            }
            .frame(height: 300)
            .listStyle(PlainListStyle())
        }
        .frame(maxHeight: .infinity)
        .ignoresSafeArea()
    }
}

struct StopwatchView_Previews: PreviewProvider {
    static var previews: some View {
        StopwatchView()
    }
}
```

### StopwatchViewModel.swift

```Swift
import Foundation
import Combine

class StopwatchViewModel: ObservableObject {
    @Published var elapsedTime: TimeInterval = 0  // ê²½ê³¼ ì‹œê°„, TimeIntervalì€ Doubleì˜ typeAlias
    
    @Published var isRunning: Bool = false  // íƒ€ì´ë¨¸ ì‹¤í–‰ ì—¬ë¶€
    @Published var isPaused: Bool = false  // íƒ€ì´ë¨¸ ì¼ì‹œì •ì§€ ì—¬ë¶€
    @Published var laps: [TimeInterval] = []  // ë© íƒ€ì„ ê¸°ë¡
    
    private var timer: AnyCancellable?  //  Timerë¥¼ êµ¬ë…í•  Combine ê°ì²´
    private var startTime: Date?  //  íƒ€ì´ë¨¸ ì‹œì‘ ì‹œê°„
    private var pausedTime: TimeInterval = 0
    
    
    
    func start() {
        guard !isRunning else { return }
        
        isRunning = true
        startTime = Date()  // í˜„ì¬ ì‹œê°„ì„ ì‹œì‘ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
        
        timer = Timer.publish(every: 0.01, on: .main, in: .common)  // í¼ë¸”ë¦¬ì…” ì„¤ì •, 0.01ì´ˆ ë§ˆë‹¤ ë°°ì¶œ
            .autoconnect()  // êµ¬ë…ìê°€ ì¶”ê°€ë˜ëŠ” ì¦‰ì‹œ ìë™ìœ¼ë¡œ íƒ€ì´ë¨¸ê°€ ì‹¤í–‰ë¨
        // .sink : í¼ë¸”ë¦¬ì…”ë¡œë¶€í„° ìƒˆë¡œìš´ ê°’ì„ ë°›ì„ë•Œë§ˆë‹¤ ì‹¤í–‰ë¨. ì¦‰, 0.01ì´ˆë§ˆë‹¤ ì‹¤í–‰
            .sink { [weak self] _ in  //selfë¥¼ ì•½í•œ ì°¸ì¡°ë¡œ ì„ ì–¸ -> ë·°ê°€ ì‚¬ë¼ì§€ë©´ ìë™ìœ¼ë¡œ í•´ì œë¨ -> ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
                guard let strongSelf = self, let start = strongSelf.startTime else { return }
                strongSelf.elapsedTime = Date().timeIntervalSince(start)  //  ì‹œì‘ ì‹œê°„ìœ¼ë¡œë¶€í„° ê²½ê³¼ ì‹œê°„ ê³„ì‚°
                strongSelf.elapsedTime = Date().timeIntervalSince(start) + strongSelf.pausedTime // ì¤‘ê°„ì—ì„œ ë©ˆì·„ì„ë•Œì˜ elapsedTimeì„ í¬í•¨í•˜ì—¬ ë‹¤ì‹œ ê²½ê³¼ì‹œê°„ ê¸°ë¡
            }
    }
    
    
    
    func stop() {
        guard isRunning else { return }  //ì‹¤í–‰ì¤‘ì´ ì•„ë‹ˆë¼ë©´ ì¢…ë£Œ
        
        timer?.cancel()  //  íƒ€ì´ë¨¸ ì •ì§€, timerê°€ nilì¸ ê²½ìš°. ì¦‰, startê°€ ì•ˆëˆŒë¦° ê²½ìš°ì—ëŠ” íŒ¨ìŠ¤
        isRunning = false
        
        if let start = startTime {
            pausedTime += Date().timeIntervalSince(start)  // ë©ˆì·„ì„ ë•Œì˜ elapsedTime ì €ì¥
        }
    }
    
    
    
    func reset() {
        stop()
        elapsedTime = 0
        pausedTime = 0
        laps = []
    }
    
    
    
    func lap() {
        laps.insert(elapsedTime, at: laps.count)  //  ìµœì‹  ë© íƒ€ì„ì„ ë¦¬ìŠ¤íŠ¸ ë§¨ ë’¤ì— ì¶”ê°€
    }
}
```

> [!important]
> 
> ### Foundation í”„ë ˆì„ì›Œí¬ì˜ Timer í´ë˜ìŠ¤
> 
> > [!important] íƒ€ì´ë¨¸ê°€ ë°˜í™˜í•˜ëŠ” PublisherëŠ” ConnectablePublisher ì¸ë°,<br>ì´ Publisherë¥¼ êµ¬ë…í•˜ì—¬ ì‹¤í–‰í•˜ë ¤ë©´ connect() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì•¼í•©ë‹ˆë‹¤.<br>ì²« subscriberê°€ êµ¬ë…í• ë•Œ, ìë™ìœ¼ë¡œ ì—°ê²°ì‹œì¼œì£¼ëŠ” ìë§¤í’ˆ autoconnect() ë©”ì„œë“œë„ ìˆì–´ìš”!<br>
> 
>   
>   
>   
> `timer = Timer.publish(every: 0.01, on: .main, in: .common)`
> 
> - `every: 0.01` â†’ ì‹œê°„ê°„ê²©, 0.01ì´ˆë§ˆë‹¤ íƒ€ì´ë¨¸ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œ
> - `on: .main` â†’ ì‹¤í–‰í•  ëŸ°ë£¨í”„, ë©”ì¸ ëŸ°ë£¨í”„ì—ì„œ ì‹¤í–‰í•˜ë€ ëœ»ì´ê³ , ë©”ì¸ìŠ¤ë ˆë“œëŠ” ui ì—…ë°ì´íŠ¸ë¥¼ ê´€ì¥í•˜ê¸° ë•Œë¬¸ì— uiê´€ë ¨ ì‘ì—…ì´ ê°€ëŠ¥í•´ì§
>     - ë©”ì¸ì´ ì•„ë‹Œ ëŸ°ë£¨í”„ì—ì„œ uiê´€ë ¨ ì‘ì—…í•˜ë©´ í¬ë˜ì‹œ ë°œìƒ
>         
>         ```Swift
>         DispatchQueue.global(qos: .background).async {
>             for i in 1...5 {
>                 sleep(1)
>                 self.label.text = "ì¹´ìš´íŠ¸: \(i)"  // âŒ í¬ë˜ì‹œ ë°œìƒ ê°€ëŠ¥!
>             }
>         }
>         ```
>         
> - `in: .common` â†’ ëŸ°ë£¨í”„ ëª¨ë“œ, .commonì€ íƒ€ì´ë¨¸ê°€ ì¼ë°˜ì ì¸ uiì´ë²¤íŠ¸ì™€ í•¨ê»˜ ì‹¤í–‰ë˜ë©°, ìŠ¤í¬ë¡¤ ì¤‘ì—ë„ ë©ˆì¶”ì§€ ì•ŠìŒ

> [!important]
> 
> ### [weak self] ì´ê²Œ ë­ì—¬
> 
> `í´ë¡œì € ë‚´ë¶€ì—ì„œ selfë¥¼ ì•½í•œì°¸ì¡°í•˜ëŠ” ë°©ë²•` â†’ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€ìš©
> 
>   
> 
> > ê·¸ëƒ¥ self ì‚¬ìš©í•˜ëŠ” ê²½ìš°
> 
> ```Swift
> class TimerViewModel {
>     var timer: Timer?
> 
>     func startTimer() {
>         timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { _ in
>             self.printMessage() // ğŸš¨ selfê°€ ê°•í•˜ê²Œ ì°¸ì¡°ë¨ â†’ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ ê°€ëŠ¥!
>         }
>     }
> 
>     func printMessage() {
>         print("ğŸ”¥ 1ì´ˆ ì§€ë‚¨!")
>     }
> }
> ```
> 
> - Timerê°€ ì‹¤í–‰ë˜ëŠ” í•œ, TimerViewModel í•´ì œë˜ì§€ ëª»í•¨ â†’ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
> 
>   
> 
> > [weak self] ì‚¬ìš©í•˜ì—¬ ì•½í•œì°¸ì¡° ì‚¬ìš©í•˜ëŠ” ê²½ìš°
> 
> ```Swift
>     func startTimer() {
>         timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { [weak self] _ in
>             self?.printMessage()  // âœ… selfê°€ ì•½í•˜ê²Œ ì°¸ì¡°ë˜ë¯€ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€!
>         }
>     }
> ```
> 
> - selfê°€ nilì´ ë˜ë©´ ìë™ìœ¼ë¡œ í´ë¡œì € ë¸”ë¡ì´ ë” ì´ìƒ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ â†’ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
> - í•˜ì§€ë§Œ self ì‚¬ìš©ë ë•Œë§ˆë‹¤ ? ë¶™ì—¬ì•¼í•˜ëŠ” ê·€ì°®ìŒâ€¦ ì§€ì €ë¶„í•¨â€¦
> 
>   
> 
> > [weak self] ì‚¬ìš©í•˜ë˜ guardë¡œ ê°•í•œ ì°¸ì¡° ì‚¬ìš©
> 
> ```Swift
> func startTimer() {
>         timer = Timer.scheduledTimer(withTimeInterval: 1.0, repeats: true) { [weak self] _ in
>             guard let strongSelf = self else { return }
>             self.printMessage() 
>         }
>     }
> ```
> 
> - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ê°€ ë˜ëŠ” nil ì¼ë•ŒëŠ” ê±¸ëŸ¬ì£¼ê³  ê·¸ì™¸ì—ëŠ” ê°•í•œì°¸ì¡° ì‚¬ìš©